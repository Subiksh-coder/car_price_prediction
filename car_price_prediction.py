# -*- coding: utf-8 -*-
"""car_price_prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1QDPNwXI0V_D5IaOQ7ezO_x0wrTCNIZM5
"""

import numpy as np
import pandas as pd

data=pd.read_csv('https://raw.githubusercontent.com/Subiksh-coder/car_price_prediction/refs/heads/main/quikr_car%20-%20quikr_car.csv')
backup=data.copy()

data = backup.copy()
data['name']=data['name'].str.split().str.slice(start=0,stop=3).str.join(' ').str.lower()

data=data[data['year'].str.isnumeric()]
data['year']=data['year'].astype(int)


data=data[data['Price'].str.lower()!='ask for price']
data['Price']=data['Price'].str.replace(',','').astype(int)


data['kms_driven']=data['kms_driven'].str.split().str.get(0).str.replace(',','')
data=data[data['kms_driven'].str.isnumeric()]
data['kms_driven']=data['kms_driven'].astype(int)

data=data[data['fuel_type']!=np.nan]
data['fuel_type']=data['fuel_type'].str.lower()

data['company']=data['company'].str.lower()
data.reset_index(drop=True)

data.describe(include='all')

x=data.drop(columns='Price')
y=data['Price']

data.to_csv('cleaned_data.csv')

from sklearn.preprocessing import OneHotEncoder
from sklearn.compose import make_column_transformer
from sklearn.pipeline import make_pipeline
from sklearn.linear_model import LinearRegression

ohe=OneHotEncoder()
ohe.fit(x[['name','company','fuel_type']])
column_tran=make_column_transformer((OneHotEncoder(categories=ohe.categories_),['name','company','fuel_type']),remainder='passthrough')

lr=LinearRegression()


pipe=make_pipeline(column_tran,lr)

from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score
x=data.drop(columns='Price')
y=data['Price']
score=[]
for i in range (1000):
    x_train,x_test,y_train,y_test=train_test_split(x,y,test_size=0.2,random_state=i)
    pipe.fit(x_train,y_train)
    y_pred=pipe.predict(x_test)
    score.append(r2_score(y_pred,y_test))

j=score.index(max(score))

x_train,x_test,y_train,y_test=train_test_split(x,y,test_size=0.2,random_state=j)

pipe.fit(x_train,y_train)
y_pred=pipe.predict(x_test)
r2_score(y_pred,y_test)

ohe.categories_[0]

name=str(input("Enter car name : "))
comp=str(input("Enter company name : "))
year=int(input("Enter year : "))
kms=int(input("Enter kms : "))
fuel=str(input("Enter fuel type : " ))

result=pipe.predict(pd.DataFrame([[name,comp,year,kms,fuel]],columns=['name','company','year','kms_driven','fuel_type']))

print(float(result[0]))